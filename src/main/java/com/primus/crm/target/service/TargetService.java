package com.primus.crm.target.service;

import com.primus.abstracts.AbstractDAO;
import com.primus.abstracts.AbstractService;
import com.primus.abstracts.TransactionUpdateDelta;
import com.primus.admin.region.model.Location;
import com.primus.common.ProductContext;
import com.primus.crm.target.model.AgentVisitTarget;
import com.primus.crm.target.model.Target;
import com.primus.crm.target.model.TotalVisitTarget;
import com.techtrade.rads.framework.utils.Utils;
import org.springframework.beans.factory.annotation.Autowired;
import org.springframework.stereotype.Component;
import org.springframework.transaction.annotation.Transactional;
import com.primus.abstracts.PrimusModel;
import com.primus.crm.target.dao.TargetDAO;

import java.util.Date;
import java.util.List;


/**
** Class Generated by Primus Auto code generator
**/
@Component
@Transactional
public class TargetService extends AbstractService {


 @Autowired
 TargetDAO targetDAO ;

  @Override
     public AbstractDAO getDAO() {
         return targetDAO;
     }


      @Override
     protected void collateBeforUpdate(PrimusModel newObject, PrimusModel oldObject) {
         Target newObj = (Target) newObject;
         Target oldObj = (Target) oldObject;

         TransactionUpdateDelta delta = formDelta(oldObj.getTotalVisitTargets(), ((Target) newObj).getTotalVisitTargets()) ;
         newObj.getTotalVisitTargets().addAll((List<TotalVisitTarget>)delta.getDeletedRecords());

          TransactionUpdateDelta delta1 = formDelta(oldObj.getAgentVisitTargets(), ((Target) newObj).getAgentVisitTargets()) ;
          if (!Utils.isNullCollection(newObj.getAgentVisitTargets()))
            newObj.getAgentVisitTargets().addAll((List<AgentVisitTarget>)delta1.getDeletedRecords());



     }

     public Target getTargetforDate(Location location , Date evalDate , ProductContext context)
     {
         return targetDAO.getTargetforDate(location.getId(),evalDate,context.getLoggedinCompany());
     }

}